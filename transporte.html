<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Transporte</title>
    <style>
        /* Estilos generales */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, #8ec5fc, #e0c3fc);
            margin: 0;
            padding: 20px;
        }

        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
            max-width: 900px;
            width: 100%;
            margin: 20px auto;
        }

        h2 {
            color: #004aad;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 25px;
        }

        .form-group {
            flex: 1 1 calc(50% - 30px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        label {
            font-size: 1rem;
            color: #333;
            font-weight: bold;
        }

        input, select, textarea {
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 1rem;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            width: 100%;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0, 123, 255, 0.3);
            outline: none;
        }

        .button-group {
            text-align: center;
            margin-top: 30px;
        }

        button {
            background: linear-gradient(90deg, #ff5722, #ff9800);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .table-container {
            margin-top: 40px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border: 1px solid #ddd;
        }

        th {
            background-color: #004aad;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Gestión de Transporte</h2>
        <form id="transporteForm" onsubmit="registrarTransporte(); return false;">
            <div class="form-row">
                <div class="form-group">
                    <label for="fechaRegistro">Fecha de Registro</label>
                    <input type="date" id="fechaRegistro" readonly>
                </div>
                <div class="form-group">
                    <label for="fechaViaje">Fecha de Viaje</label>
                    <input type="date" id="fechaViaje" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="tipoViaje">Tipo de Viaje</label>
                    <select id="tipoViaje" required>
                        <option value="" disabled selected>Seleccione una opción</option>
                        <option value="Llegada">Llegada</option>
                        <option value="Salida">Salida</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="horaViaje">Hora del Viaje</label>
                    <input type="time" id="horaViaje" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="destinoInicial">Destino Inicial</label>
                    <input list="destinosIniciales" id="destinoInicial" placeholder="Seleccione o escriba un destino" required>
                    <datalist id="destinosIniciales">
                        <option value="Aeropuerto Internacional de las Américas">
                        <option value="Aeropuerto Internacional del Cibao">
                        <option value="Aeropuerto Internacional de Punta Cana">
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="destinoFinal">Destino Final</label>
                    <input list="destinosFinales" id="destinoFinal" placeholder="Seleccione o escriba un destino" required>
                    <datalist id="destinosFinales">
                        <option value="Aeropuerto Internacional de las Américas">
                        <option value="Aeropuerto Internacional del Cibao">
                        <option value="Aeropuerto Internacional de Punta Cana">
                    </datalist>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="numPersonas">Número de Personas</label>
                    <input type="number" id="numPersonas" min="1" placeholder="Ingrese el número de personas" required>
                </div>
                <div class="form-group">
                    <label for="chofer">Chofer</label>
                    <select id="chofer" required>
                        <option value="" disabled selected>Seleccione un chofer</option>
                        <option value="Henrry">Henrry</option>
                        <option value="Domingo">Domingo</option>
                        <option value="Juan">Juan</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            <div class="form-group-full">
                <label for="comentarios">Comentarios Adicionales</label>
                <textarea id="comentarios" rows="3" placeholder="Escriba comentarios adicionales"></textarea>
            </div>
            <div class="button-group">
                <button type="submit">Guardar</button>
            </div>
        </form>
    </div>

    <div class="container table-container">
        <h2>Transporte Registrado</h2>
        <table id="tablaTransporte">
            <thead>
                <tr>
                    <th>Fecha Registro</th>
                    <th>Fecha Viaje</th>
                    <th>Hora</th>
                    <th>Tipo</th>
                    <th>Destino Inicial</th>
                    <th>Destino Final</th>
                    <th>Número de Personas</th>
                    <th>Chofer</th>
                    <th>Comentarios</th>
                </tr>
            </thead>
            <tbody>
                <!-- Filas dinámicas -->
            </tbody>
        </table>
    </div>

    <script>
        const apiKey = 'patL0v30ZFJzTux8W.c464296609147a785c6cfd6ccb96863088259df68518b69e56000c44eb73f0f0';
        const baseId = 'appLJWGTQ6xFXTRDl';
        const tableName = 'Transporte';

        document.addEventListener("DOMContentLoaded", async () => {
            document.getElementById("fechaRegistro").value = obtenerFechaLocal();
 
            await cargarViajes(); // Cargar datos al cargar la página
        });
        function agregarFilaATabla(transporte) {
    console.log("Agregando transporte:", transporte); // Depuración
    const tabla = document.getElementById("tablaTransporte").getElementsByTagName("tbody")[0];
    const fila = tabla.insertRow();

    const hoy = new Date().toISOString().split("T")[0];
    const diferencia = diferenciaDias(hoy, transporte.FechaViaje);

    fila.innerHTML = `
    <td>${formatoFechaDDMMYY(transporte.FechaRegistro) || ""}</td>
    <td>${formatoFechaDDMMYY(transporte.FechaViaje) || ""}</td>
    <td>${transporte.HoraViaje || ""}</td>
    <td>${transporte.TipoViaje || ""}</td>
    <td>${transporte.DestinoInicial || ""}</td>
    <td>${transporte.DestinoFinal || ""}</td>
    <td>${transporte.NumeroPersonas || ""}</td>
    <td>${transporte.Chofer || ""}</td>
    <td>${transporte.Comentarios || ""}</td>
`;


    if (diferencia > 0 && diferencia <= 3) {
        fila.style.backgroundColor = "red";
        fila.style.color = "white";
        fila.style.fontWeight = "bold";
    }
}

     
async function cargarViajes() {
    try {
        const url = `https://api.airtable.com/v0/${baseId}/${tableName}`;
        const response = await fetch(url, {
            method: "GET",
            headers: {
                Authorization: `Bearer ${apiKey}`,
            },
        });

        if (response.ok) {
            const data = await response.json();
            console.log("Datos obtenidos desde Airtable:", data); // Depuración
            const registros = data.records.map(record => record.fields);

            const hoy = new Date().toISOString().split("T")[0];
            const viajesValidos = registros.filter(viaje => {
                console.log("Verificando fecha de viaje:", viaje.FechaViaje); // Depuración
                if (!viaje.FechaViaje) return false;
                return new Date(viaje.FechaViaje) >= new Date(hoy);
            });

            viajesValidos.forEach(viaje => agregarFilaATabla(viaje));
        } else {
            const error = await response.json();
            console.error("Error al cargar datos desde Airtable:", error);
        }
    } catch (error) {
        console.error("Error al conectar con Airtable:", error);
    }
}

async function registrarTransporte() {
    const transporte = {
        FechaRegistro: document.getElementById("fechaRegistro").value,
        FechaViaje: document.getElementById("fechaViaje").value,
        HoraViaje: document.getElementById("horaViaje").value,
        TipoViaje: document.getElementById("tipoViaje").value,
        DestinoInicial: document.getElementById("destinoInicial").value,
        DestinoFinal: document.getElementById("destinoFinal").value,
        NumeroPersonas: parseInt(document.getElementById("numPersonas").value, 10),
        Chofer: document.getElementById("chofer").value,
        Comentarios: document.getElementById("comentarios").value || "",
    };

    try {
        const response = await fetch(`https://api.airtable.com/v0/${baseId}/${tableName}`, {
            method: "POST",
            headers: {
                Authorization: `Bearer ${apiKey}`,
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ fields: transporte }),
        });

        if (response.ok) {
            alert("Registro guardado con éxito");
            const data = await response.json();
            agregarFilaATabla(data.fields);
            limpiarFormulario();
        } else {
            const error = await response.json();
            console.error("Error al guardar:", error);
        }
    } catch (error) {
        console.error("Error al conectar:", error);
    }
}

        function limpiarFormulario() {
            document.getElementById("fechaViaje").value = "";
            document.getElementById("horaViaje").value = "";
            document.getElementById("tipoViaje").value = "";
            document.getElementById("destinoInicial").value = "";
            document.getElementById("destinoFinal").value = "";
            document.getElementById("numPersonas").value = "";
            document.getElementById("chofer").value = "";
            document.getElementById("comentarios").value = "";
        }
        function diferenciaDias(fecha1, fecha2) {
    const diaEnMilisegundos = 1000 * 60 * 60 * 24;
    const fecha1Obj = new Date(fecha1); // Convierte la fecha en objeto Date
    const fecha2Obj = new Date(fecha2); // Convierte la fecha en objeto Date
    return Math.ceil((fecha2Obj - fecha1Obj) / diaEnMilisegundos); // Diferencia en días
}
function formatoFechaDDMMYY(fecha) {
    if (!fecha) return ""; // Retorna vacío si no hay fecha
    const fechaObj = new Date(fecha);
    const dia = String(fechaObj.getDate()).padStart(2, "0");
    const mes = String(fechaObj.getMonth() + 1).padStart(2, "0");
    const anio = String(fechaObj.getFullYear()).slice(-2); // Últimos dos dígitos del año
    return `${dia}/${mes}/${anio}`;
}
function obtenerFechaLocal() {
    const fecha = new Date();
    const anio = fecha.getFullYear();
    const mes = String(fecha.getMonth() + 1).padStart(2, "0"); // Meses son 0 indexados
    const dia = String(fecha.getDate()).padStart(2, "0");
    return `${anio}-${mes}-${dia}`; // Formato YYYY-MM-DD para inputs de tipo date
}



    </script>
</body>
</html>
